<!-- Navbar with Language and Logout -->
<nav class="profile-navbar">
  <div class="nav__header">
    <div class="nav__logo-container">
      <img class="nav__logo" src="assets/logo.png" alt="">
      <span class="nav__logo-text">EvaluAction</span>
    </div>
    <!-- Language Switcher - Same row as EvaluAction -->
    <div class="language-menu-container">
      <button 
        class="lang-icon-btn" 
        type="button"
        (click)="toggleLanguageMenu()"
        [attr.aria-expanded]="showLanguageMenu"
        [attr.aria-label]="'Language selector'"
        [attr.aria-haspopup]="true">
        <i class="fas fa-globe" [class.rotating]="showLanguageMenu"></i>
        <span class="current-lang-indicator">{{ currentLang.toUpperCase() }}</span>
      </button>
      <div 
        class="language-dropdown" 
        [class.show]="showLanguageMenu"
        role="menu"
        [attr.aria-hidden]="!showLanguageMenu">
        <button 
          class="lang-option" 
          type="button"
          role="menuitem"
          [class.active]="currentLang === 'fr'"
          (click)="switchLanguage('fr')"
          [attr.aria-current]="currentLang === 'fr' ? 'true' : null">
          <span class="lang-flag">ðŸ‡«ðŸ‡·</span>
          <span class="lang-content">
            <span class="lang-code">FR</span>
            <span class="lang-name">FranÃ§ais</span>
          </span>
          <i class="fas fa-check check-icon" *ngIf="currentLang === 'fr'"></i>
        </button>
        <button 
          class="lang-option" 
          type="button"
          role="menuitem"
          [class.active]="currentLang === 'ar'"
          (click)="switchLanguage('ar')"
          [attr.aria-current]="currentLang === 'ar' ? 'true' : null">
          <span class="lang-flag">ðŸ‡¸ðŸ‡¦</span>
          <span class="lang-content">
            <span class="lang-code">Ø¹Ø±Ø¨ÙŠ</span>
            <span class="lang-name">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</span>
          </span>
          <i class="fas fa-check check-icon" *ngIf="currentLang === 'ar'"></i>
        </button>
        <button 
          class="lang-option" 
          type="button"
          role="menuitem"
          [class.active]="currentLang === 'en'"
          (click)="switchLanguage('en')"
          [attr.aria-current]="currentLang === 'en' ? 'true' : null">
          <span class="lang-flag">ðŸ‡¬ðŸ‡§</span>
          <span class="lang-content">
            <span class="lang-code">EN</span>
            <span class="lang-name">English</span>
          </span>
          <i class="fas fa-check check-icon" *ngIf="currentLang === 'en'"></i>
        </button>
      </div>
    </div>
    <!-- Logout Button - Same row as EvaluAction -->
    <button 
      class="logout-btn" 
      type="button"
      (click)="changeAccount()"
      [attr.aria-label]="'navbar.buttons.change_account' | translate">
      <i class="fas fa-sign-out-alt"></i>
      <span>{{ 'navbar.buttons.change_account' | translate }}</span>
    </button>
    <div class="nav__menu__btn" id="menu-btn">
      <span><i class="ri-menu-line"></i></span>
    </div>
  </div>
  <ul class="nav__links" id="nav-links">
    <li class="nav__actions">
      <div class="nav__actions-container">
        <!-- Empty - actions moved to header -->
      </div>
    </li>
  </ul>
</nav>

<div class="body">
  <div class="clouds-container">
    <div class="cloud cloud-1"></div>
    <div class="cloud cloud-2"></div>
    <div class="cloud cloud-3"></div>
    <div class="cloud cloud-4"></div>
    <div class="cloud cloud-5"></div>
    <div class="cloud cloud-6"></div>
  </div>

<section class="hero-section" style="zoom: 80%;">
  <!-- Welcome message with background image -->
  <div class="welcome-message">
    <img src="assets/image_client/bg-5.png" alt="Background" class="welcome-background">
    <div class="welcome-content">
      <h1>{{ 'hero_section.welcome_message' | translate:{userName: userName} }}</h1>
      <p>{{ 'hero_section.select_child_prompt' | translate }}</p>
    </div>
    <img src="assets/image/junior.gif" alt="Junior" class="welcome-junior-gif">
  </div>

  <!-- Search bar with profile count -->
  <div class="search-bar-container">
    <div class="search-bar">
      <span class="p-input-icon-left">
        <i class="pi pi-search"></i>
        <input pInputText type="text" [(ngModel)]="searchTerm" [placeholder]="'hero_section.search_placeholder' | translate"
          (input)="filterChildren()" class="search-input" />
      </span>
    </div>
    <!-- Profile Count Indicator -->
    <div class="profile-count-indicator" *ngIf="filteredChildren.length > 0">
      <div class="profile-count-badge">
        <i class="fas fa-users"></i>
        <span class="profile-count-number">{{ filteredChildren.length }}</span>
        <span class="profile-count-text">
          {{ filteredChildren.length === 1 ? 'Profile' : 'Profiles' }}
        </span>
      </div>
    </div>
  </div>

  <div class="card-grid">
    <!-- Navigation arrows - always show if more than 3 profiles -->
    <button 
      *ngIf="showNavigationArrows"
      class="nav-arrow nav-arrow-left" 
      (click)="navigateLeft()"
      aria-label="Previous cards">
      <i class="fas fa-chevron-left"></i>
    </button>

    <!-- Container with scroll for cards -->
    <div class="cards-container-wrapper">
      <!-- 3D Carousel - only show when there are children -->
      <div class="card-3d" 
           *ngIf="filteredChildren.length > 0"
           [class.navigating]="isNavigating"
           [style.transform]="'perspective(800px) rotateY(' + rotationAngle + 'deg)'"
           (mousedown)="onMouseDown($event)"
           (touchstart)="onTouchStart($event)">
        <!-- List of children - show all filtered children for 3D carousel effect -->
        <div class="card-3d-item" 
             *ngFor="let child of filteredChildren; let i = index"
             [style.transform]="getCardTransform(i)"
             [style.animation-delay]="getCardAnimationDelay(i) + 's'">
          <div class="card" (click)="navigateToClient(child.id!)">
            <img [src]="child.image_url" (error)="setDefaultImage($event, child)" alt="Child" class="card__image">
            <h2 class="card__name">{{ child.first_name }} {{ child.last_name }}</h2>
            <div class="card__actions">
              <button pButton class="custom-edit-btn rounded-btn"
                (click)="showEditDialog(child); $event.stopPropagation()">
                <i class="pi pi-pencil"></i>
              </button>
              <button pButton class="custom-disable-btn rounded-btn"
                (click)="disableChild(child); $event.stopPropagation()">
                <i class="pi pi-trash"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
      <!-- Message if list is empty -->
      <div class="no-children-container" *ngIf="filteredChildren.length === 0">
        <div class="cloud-message">
          <div class="cloud-bubble">
            <p>{{ 'hero_section.no_children_cloud_message' | translate }}</p>
          </div>
        </div>
        <div class="panda-image-container">
          <img src="assets/img/panda.png" alt="Panda" class="panda-image">
        </div>
      </div>
    </div>

    <!-- Navigation arrows - always show if more than 3 profiles -->
    <button 
      *ngIf="showNavigationArrows"
      class="nav-arrow nav-arrow-right" 
      (click)="navigateRight()"
      aria-label="Next cards">
      <i class="fas fa-chevron-right"></i>
    </button>

  </div>
  
  <!-- Floating Add Button -->
  <button 
    class="floating-add-btn" 
    [class.disabled]="displayDialog"
    [disabled]="displayDialog"
    (click)="showDialog()" 
    [attr.aria-label]="'hero_section.add_child_button' | translate">
    <i class="fas" [class.fa-plus]="!displayDialog" [class.fa-spinner]="displayDialog" [class.rotating]="displayDialog"></i>
    <span class="floating-btn-text">{{ 'hero_section.add_child_button' | translate }}</span>
  </button>
</section>

<!-- Add Profile Modal -->
<div *ngIf="displayDialog" class="modal-overlay" (click)="cancel()">
  <div class="add-profile-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <div class="modal-header-content">
        <div class="modal-icon-wrapper">
          <i class="fas fa-user-plus"></i>
        </div>
        <div class="modal-title-wrapper">
          <h3 class="modal-title">{{ 'add_child_dialog.header' | translate }}</h3>
          <p class="modal-subtitle">{{ 'add_child_dialog.modal_subtitle' | translate }}</p>
        </div>
      </div>
      <button 
        type="button"
        class="modal-close-btn"
        (click)="cancel()"
        [attr.aria-label]="'add_child_dialog.buttons.cancel' | translate">
        <i class="fas fa-times"></i>
      </button>
    </div>

    <div class="modal-body">
      <div class="form-row">
        <div class="form-group">
          <label for="firstName" class="form-label">
            <i class="fas fa-user"></i>
            <span>{{ 'add_child_dialog.labels.first_name' | translate }}</span>
          </label>
          <input 
            id="firstName" 
            type="text" 
            [(ngModel)]="newChild.first_name"
            class="form-input"
            [placeholder]="'add_child_dialog.placeholders.first_name' | translate" 
            required />
        </div>
        <div class="form-group">
          <label for="lastName" class="form-label">
            <i class="fas fa-user"></i>
            <span>{{ 'add_child_dialog.labels.last_name' | translate }}</span>
          </label>
          <input 
            id="lastName" 
            type="text" 
            [(ngModel)]="newChild.last_name"
            class="form-input"
            [placeholder]="'add_child_dialog.placeholders.last_name' | translate" 
            required />
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label for="birthDate" class="form-label">
            <i class="fas fa-calendar-alt"></i>
            <span>{{ 'add_child_dialog.labels.birth_date' | translate }}</span>
          </label>
          <input 
            id="birthDate" 
            type="date" 
            [(ngModel)]="newChild.birth_date"
            class="form-input"
            required />
        </div>
        <div class="form-group">
          <label for="diagnosis" class="form-label">
            <i class="fas fa-stethoscope"></i>
            <span>{{ 'add_child_dialog.labels.diagnosis' | translate }}</span>
          </label>
          <input 
            id="diagnosis" 
            type="text" 
            [(ngModel)]="newChild.diagnosis"
            class="form-input"
            [placeholder]="'add_child_dialog.placeholders.diagnosis' | translate" />
        </div>
      </div>
      <div class="form-group">
        <label class="form-label">
          <i class="fas fa-venus-mars"></i>
          <span>{{ 'add_child_dialog.labels.gender' | translate }}</span>
        </label>
        <div class="gender-radio-group">
          <div class="radio-option">
            <input type="radio" id="maleAdd" name="genderAdd" value="M" [(ngModel)]="newChild.gender">
            <label for="maleAdd">{{ 'add_child_dialog.gender_options.male' | translate }}</label>
          </div>
          <div class="radio-option">
            <input type="radio" id="femaleAdd" name="genderAdd" value="F" [(ngModel)]="newChild.gender">
            <label for="femaleAdd">{{ 'add_child_dialog.gender_options.female' | translate }}</label>
          </div>
        </div>
      </div>
      <div class="form-group">
        <label for="image" class="form-label">
          <i class="fas fa-image"></i>
          <span>{{ 'add_child_dialog.labels.image' | translate }}</span>
        </label>
        <div class="drop-zone" 
             (dragover)="onDragOver($event)" 
             (dragleave)="onDragLeave($event)" 
             (drop)="onDrop($event)"
             (click)="fileInput.click()">
          <input #fileInput type="file" id="image" (change)="onFileSelected($event)" accept="image/*" hidden />
          <div *ngIf="!selectedFile" class="drop-zone-text">
            <i class="fas fa-cloud-upload-alt"></i>
            <span>{{ 'add_child_dialog.drop_zone_text' | translate }}</span>
          </div>
          <div *ngIf="selectedFile" class="drop-zone-preview">
            <i class="fas fa-file-image"></i>
            <span>{{ selectedFile.name }}</span>
          </div>
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button 
        type="button"
        class="modal-btn-secondary"
        (click)="cancel()">
        <i class="fas fa-times"></i>
        <span>{{ 'add_child_dialog.buttons.cancel' | translate }}</span>
      </button>
      <button 
        type="button"
        class="modal-btn-primary"
        (click)="addChild()"
        [disabled]="isLoading">
        <i class="fas fa-plus"></i>
        <span>{{ 'add_child_dialog.buttons.add' | translate }}</span>
      </button>
    </div>
  </div>
</div>

<!-- Edit Profile Modal -->
<div *ngIf="updatedisplayDialog" class="modal-overlay" (click)="cancel()">
  <div class="add-profile-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <div class="modal-header-content">
        <div class="modal-icon-wrapper">
          <i class="fas fa-user-edit"></i>
        </div>
        <div class="modal-title-wrapper">
          <h3 class="modal-title">{{ 'edit_child_dialog.header' | translate }}</h3>
          <p class="modal-subtitle">{{ 'edit_child_dialog.modal_subtitle' | translate }}</p>
        </div>
      </div>
      <button 
        type="button"
        class="modal-close-btn"
        (click)="cancel()"
        [attr.aria-label]="'edit_child_dialog.buttons.cancel' | translate">
        <i class="fas fa-times"></i>
      </button>
    </div>

    <div class="modal-body">
      <div class="form-row">
        <div class="form-group">
          <label for="editFirstName" class="form-label">
            <i class="fas fa-user"></i>
            <span>{{ 'edit_child_dialog.labels.first_name' | translate }}</span>
          </label>
          <input 
            id="editFirstName" 
            type="text" 
            [(ngModel)]="selectedChild.first_name"
            class="form-input"
            [placeholder]="'edit_child_dialog.placeholders.first_name' | translate" 
            required />
        </div>
        <div class="form-group">
          <label for="editLastName" class="form-label">
            <i class="fas fa-user"></i>
            <span>{{ 'edit_child_dialog.labels.last_name' | translate }}</span>
          </label>
          <input 
            id="editLastName" 
            type="text" 
            [(ngModel)]="selectedChild.last_name"
            class="form-input"
            [placeholder]="'edit_child_dialog.placeholders.last_name' | translate" 
            required />
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label for="editBirthDate" class="form-label">
            <i class="fas fa-calendar-alt"></i>
            <span>{{ 'edit_child_dialog.labels.birth_date' | translate }}</span>
          </label>
          <input 
            id="editBirthDate" 
            type="date" 
            [(ngModel)]="selectedChild.birth_date"
            class="form-input"
            required />
        </div>
        <div class="form-group">
          <label for="editDiagnosis" class="form-label">
            <i class="fas fa-stethoscope"></i>
            <span>{{ 'edit_child_dialog.labels.diagnosis' | translate }}</span>
          </label>
          <input 
            id="editDiagnosis" 
            type="text" 
            [(ngModel)]="selectedChild.diagnosis"
            class="form-input"
            [placeholder]="'edit_child_dialog.placeholders.diagnosis' | translate" />
        </div>
      </div>
      <div class="form-group">
        <label class="form-label">
          <i class="fas fa-venus-mars"></i>
          <span>{{ 'edit_child_dialog.labels.gender' | translate }}</span>
        </label>
        <div class="gender-radio-group">
          <div class="radio-option">
            <input type="radio" id="maleEdit" name="genderEdit" value="M" [(ngModel)]="selectedChild.gender">
            <label for="maleEdit">{{ 'edit_child_dialog.gender_options.male' | translate }}</label>
          </div>
          <div class="radio-option">
            <input type="radio" id="femaleEdit" name="genderEdit" value="F" [(ngModel)]="selectedChild.gender">
            <label for="femaleEdit">{{ 'edit_child_dialog.gender_options.female' | translate }}</label>
          </div>
        </div>
      </div>
      <div class="form-group">
        <label for="editImage" class="form-label">
          <i class="fas fa-image"></i>
          <span>{{ 'edit_child_dialog.labels.image' | translate }}</span>
        </label>
        <div class="drop-zone" 
             (dragover)="onDragOver($event)" 
             (dragleave)="onDragLeave($event)" 
             (drop)="onDrop($event)"
             (click)="editFileInput.click()">
          <input #editFileInput type="file" id="editImage" (change)="onFileSelected($event)" accept="image/*" hidden/>
          <div *ngIf="!selectedFile" class="drop-zone-text">
            <i class="fas fa-cloud-upload-alt"></i>
            <span>{{ 'edit_child_dialog.drop_zone_text' | translate }}</span>
          </div>
          <div *ngIf="selectedFile" class="drop-zone-preview">
            <i class="fas fa-file-image"></i>
            <span>{{ selectedFile.name }}</span>
          </div>
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button 
        type="button"
        class="modal-btn-secondary"
        (click)="cancel()">
        <i class="fas fa-times"></i>
        <span>{{ 'edit_child_dialog.buttons.cancel' | translate }}</span>
      </button>
      <button 
        type="button"
        class="modal-btn-primary"
        (click)="saveChild()">
        <i class="fas fa-save"></i>
        <span>{{ 'edit_child_dialog.buttons.update' | translate }}</span>
      </button>
    </div>
  </div>
</div>
</div>