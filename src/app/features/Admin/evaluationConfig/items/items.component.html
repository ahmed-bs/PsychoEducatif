<div class="back-button" (click)="goBack()">
  <span class="material-symbols-sharp">arrow_back</span>
</div>
<br> <br>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Sharp" rel="stylesheet">

<div class="container-custom">
  <!-- Add Item Form -->
  <div class="card p-4 shadow-lg rounded-2xl bg-white mb-4">
    <h3 class="text-xl font-semibold mb-4">Ajouter un item</h3>
    <form [formGroup]="itemForm" (ngSubmit)="onSubmit()" class="grid-form">
      <div class="form-group">
        <label for="domain">Domaine</label>
        <p-dropdown id="domain" [options]="domaines" formControlName="domainId" optionLabel="title" optionValue="id" 
          placeholder="Sélectionner un domaine" [style]="{'width':'100%'}"></p-dropdown>
      </div>
      
      <div class="form-group">
        <label for="description">Description</label>
        <input pInputText id="description" type="text" formControlName="description" 
          placeholder="Description de l'item" class="w-full">
      </div>

      <div class="form-group">
        <label for="status">État</label>
        <p-dropdown id="status" [options]="statusOptions" formControlName="status" optionLabel="label" optionValue="value"
          placeholder="Sélectionner un état" [style]="{'width':'100%'}"></p-dropdown>
      </div>

      <div class="form-actions">
        <button pButton type="submit" label="Ajouter" icon="pi pi-plus" 
          [disabled]="!itemForm.valid" class="p-button-success"></button>
      </div>
    </form>
  </div>

  <!-- Domains and Items List -->
  <div class="domains-container">
    @for (domaine of domaines; track domaine.id) {
    <div class="card p-4 shadow-lg rounded-2xl bg-white mb-4">
      <div class="domain-header" (click)="toggleDomain(domaine)">
        <div class="domain-info">
          <h3 class="domain-title">{{domaine.title}}</h3>
          <span class="domain-code">{{domaine.code}}</span>
          <span class="items-count">({{domaine.items.length || 0}} items)</span>
        </div>
        <span class="material-symbols-sharp">
          {{domaine.expanded ? 'expand_less' : 'expand_more'}}
        </span>
      </div>

      @if (domaine.expanded) {
      <div class="items-list mt-4">
        @if (domaine.items.length) {
        @for (item of domaine.items; track item.id) {
        <div class="item-row">
          <div class="item-content">
            <p class="item-description">{{item.description}}</p>
            <span class="status-badge" [class]="'status-' + item.status.toLowerCase().replace('_', '-')">
              {{getStatusLabel(item.status)}}
            </span>
          </div>
          <div class="item-actions">
            <button pButton icon="pi pi-pencil" class="p-button-text p-button-rounded p-button-info"
              (click)="editItem(item)"></button>
            <button pButton icon="pi pi-trash" class="p-button-text p-button-rounded p-button-danger"
              (click)="deleteItem(item)"></button>
          </div>
        </div>
        }
        } @else {
        <p class="no-items">Aucun item dans ce domaine</p>
        }
      </div>
      }
    </div>
    }
  </div>
</div>