<div class="container">
    <main>
        <div class="head-title">
            <div class="left">
                <h1>üè† Bienvenue sur le Tableau de Bord</h1>
                <ul class="breadcrumb">
                    <li>
                        <a href="#">Tableau de bord</a>
                    </li>
                    <li><i class="bx bx-chevron-right"></i></li>
                    <li>
                        <a class="active" href="#">Tableau de Bord</a>
                    </li>
                </ul>
            </div>
            <div class="right">

            </div>
        </div>

        <div class="container mx-auto px-2 sm:px-4 md:px-8 py-4 max-w-6xl">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4">
                <h1 class="text-2xl md:text-3xl font-bold text-indigo-800"></h1>
                <div class="flex flex-col sm:flex-row items-stretch sm:items-center space-y-2 sm:space-y-0 sm:space-x-4 w-full sm:w-auto">
                    <div class="dropdown relative w-full sm:w-auto">
                        <div class="dropdown-content mt-1">
                            <div *ngFor="let child of filteredChildren" class="dropdown-item" [class.active]="child.id === selectedChild?.id">
                                <div class="w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center mr-3">
                                    <i class="fas fa-child text-indigo-600"></i>
                                </div>
                                <div>
                                    <div class="font-medium">{{ child.first_name }} {{ child.last_name }}</div>
                                    <div class="text-xs text-gray-500">{{ calculateAge(child.birth_date) }} ‚Ä¢ {{
                                        child.diagnosis || 'Non sp√©cifi√©' }}</div>
                                </div>
                            </div>
                            <div class="border-t border-gray-200"></div>
                            <div class="dropdown-item">
                                <i class="fas fa-plus-circle text-indigo-600 mr-3"></i>
                                <div class="font-medium text-indigo-600" (click)="showDialog()">Ajouter un nouveau
                                    profil</div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-md overflow-hidden mb-8">
                <div class="flex flex-col md:flex-row">
                    <div class="md:w-1/4 bg-indigo-100 p-6 flex flex-col items-center justify-center">
                        <div class="w-24 h-24 md:w-32 md:h-32 rounded-full bg-indigo-200 flex items-center justify-center mb-4 overflow-hidden">
                            <span *ngIf="selectedChild?.first_name && selectedChild?.last_name" class="text-4xl font-bold text-indigo-800">
                                {{ selectedChild?.first_name?.charAt(0) }}{{ selectedChild?.last_name?.charAt(0) }}
                            </span>
                            <i *ngIf="!(selectedChild?.first_name && selectedChild?.last_name)" class="fas fa-user text-4xl text-indigo-400"></i>
                        </div>
                    </div>
                    <div class="md:w-3/4 p-4 md:p-6" *ngIf="selectedChild">
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                            <div>
                                <h2 class="text-xl md:text-2xl font-bold text-gray-800">{{ selectedChild.first_name }} {{
                                    selectedChild.last_name }}
                                </h2>
                                <div class="flex flex-wrap items-center mt-2 gap-2">
                                    <span class="bg-blue-100 text-blue-800 text-xs md:text-sm font-medium px-2.5 py-0.5 rounded">{{
                                        calculateAge(selectedChild.birth_date) }}</span>
                                    <span class="bg-purple-100 text-purple-800 text-xs md:text-sm font-medium px-2.5 py-0.5 rounded">{{
                                        selectedChild.gender === 'M' ? '‚ôÇ Male' : '‚ôÄ Female' }}</span>
                                </div>
                                <p class="text-gray-600 mt-2 text-xs md:text-base"><i class="fas fa-calendar-alt mr-2 text-indigo-500"></i> Derni√®re
                                    √©valuation: 15/06/2023</p>
                            </div>
                            <div class="flex flex-col sm:flex-row items-stretch sm:items-center space-y-2 sm:space-y-0 sm:space-x-4 w-full sm:w-auto">
                                <button (click)="showShareDialog()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition flex items-center w-full sm:w-auto">
                                    <i class="fas fa-share-alt mr-2"></i> Partager le profil
                                </button>
                            </div>
                        </div>

                        <div class="border-b border-gray-200 mt-4">
                            <ul class="flex flex-wrap -mb-px overflow-x-auto md:overflow-visible">
                                <li class="mr-2" *ngFor="let tab of tabs">
                                    <button class="inline-block p-2 md:p-4 border-b-2 rounded-t-lg font-medium text-xs md:text-base" [class.border-indigo-600]="isTabActive(tab.id)" [class.text-indigo-600]="isTabActive(tab.id)" [class.border-transparent]="!isTabActive(tab.id)" [class.hover:text-gray-600]="!isTabActive(tab.id)" [class.hover:border-gray-300]="!isTabActive(tab.id)" (click)="switchTab(tab.id)">
                                        {{tab.label}}
                                    </button>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <div id="tab-contents">
                <div class="tab-content active" id="skills-content" [class.active]="isTabActive('skills')">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-6">
                        <div *ngFor="let category of filteredCategories" class="bg-white rounded-xl shadow overflow-hidden">
                            <div class="bg-indigo-600 px-4 py-3 sm:px-6 sm:py-4 flex justify-between items-center">
                                <h3 class="text-lg sm:text-xl font-medium text-white">{{ category.name }} ({{
                                    (domains[category.id!] || []).length }} comp√©tences)</h3>
                            </div>
                            <div class="p-4 sm:p-6">
                                <div *ngFor="let domain of domains[category.id!]" class="skill-card bg-indigo-50 p-3 sm:p-4 rounded-lg mb-3 sm:mb-4 last:mb-0">
                                    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-2">
                                        <h4 class="font-medium text-indigo-800 text-base sm:text-lg mb-1 sm:mb-0">{{ domain.name }}</h4> <span class="text-sm sm:text-base font-medium text-gray-700">Progr√®s: {{
                                            domain.acquis_percentage }}%</span>
                                    </div>
                                    <div class="progress-bar h-2 sm:h-3 bg-gray-200 rounded-full">
                                        <div class="progress-fill h-full bg-indigo-600 rounded-full transition-all duration-500 ease-out" [style.width]="domain.acquis_percentage + '%'">
                                        </div>
                                    </div>
                                    <div class="mt-3 flex flex-col sm:flex-row justify-between text-xs sm:text-sm text-gray-600 space-y-1 sm:space-y-0"> <span>D√©but: {{ formatDate(domain.start_date) }}</span>
                                        <span>Derni√®re √©val: {{ formatDate(domain.last_eval_date) }}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tab-content" id="stats-content" [class.active]="isTabActive('stats')">
                    <div class="grid grid-cols-1 mb-6">
                        <div class="bg-white rounded-xl shadow-md p-6 flex flex-col items-center chart-container">
                            <div class="w-full h-64">
                                <canvas baseChart [data]="skillsChartData" [options]="skillsChartOptions" [type]="'doughnut'">
                                </canvas>
                            </div>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div class="bg-white rounded-xl shadow-md p-6 flex flex-col items-center chart-container">
                            <div class="w-full h-64">
                                <canvas baseChart [data]="progressChartData" [options]="progressChartOptions" [type]="'bar'">
                                </canvas>
                            </div>
                        </div>
                        <div class="bg-white rounded-xl shadow-md p-6 flex flex-col items-center chart-container">
                            <div class="w-full h-64">
                                <canvas baseChart [data]="lineChartData" [options]="lineChartOptions" [type]="'line'">
                                </canvas>
                            </div>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 mb-8">
                        <div class="bg-white rounded-xl shadow-md p-6 flex flex-col items-center chart-container">
                            <div class="w-full h-64">
                                <canvas baseChart [data]="polarChartData" [options]="polarChartOptions" [type]="'polarArea'">
                                </canvas>
                            </div>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                        <div class="bg-white rounded-xl shadow-md p-6">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                                <i class="fas fa-chart-line text-indigo-600 mr-2"></i>
                                Aper√ßu des Progr√®s
                            </h3>
                            <div class="space-y-4">
                                <div *ngFor="let category of filteredCategories" class="category-progress-card">
                                    <div class="flex justify-between items-center mb-2">
                                        <span class="font-medium text-gray-700">{{ category.name }}</span>
                                        <span class="text-sm text-gray-500">{{ (domains[category.id!] || []).length }} comp√©tences</span>
                                    </div>
                                    <div class="progress-bar">
                                        <div class="progress-fill" [style.width]="getCategoryProgress(category.id!) + '%'">
                                        </div>
                                    </div>
                                    <div class="flex justify-between text-xs text-gray-500 mt-1">
                                        <span>Progr√®s: {{ getCategoryProgress(category.id!) }}%</span>
                                        <span>Objectif: 85%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white rounded-xl shadow-md p-6">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                                <i class="fas fa-clock text-green-600 mr-2"></i>
                                Activit√© R√©cente
                            </h3>
                            <div class="space-y-4">
                                <div *ngFor="let category of filteredCategories.slice(0, 3)" class="activity-item">
                                    <div class="flex items-start space-x-3">
                                        <div class="flex-shrink-0">
                                            <div class="activity-icon">
                                                <i class="fas fa-star text-sm"></i>
                                            </div>
                                        </div>
                                        <div class="flex-1 min-w-0">
                                            <p class="text-sm font-medium text-gray-900">{{ category.name }}</p>
                                            <p class="text-sm text-gray-500">
                                                {{ (domains[category.id!] || []).length }} comp√©tences √©valu√©es
                                            </p>
                                            <p class="text-xs text-gray-400">Derni√®re mise √† jour: {{ getLastUpdateDate() }}</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tab-content" id="goals-content" [class.active]="isTabActive('goals')">
                    <app-goals [goals]="goals" (addGoalClicked)="openAddGoalModal()" (editGoalClicked)="openEditGoalModal($event)" (toggleSubObjectiveStatus)="onToggleSubObjective($event)" (deleteGoalClicked)="onDeleteGoal($event)"></app-goals>
                </div>
                <app-add-goal-modal *ngIf="showGoalFormModal" [isVisible]="showGoalFormModal" [goalToEdit]="goalToEdit" (close)="closeGoalFormModal()" (goalSaved)="onGoalSaved($event)" [currentProfileId]="currentProfileIdForModal">
                </app-add-goal-modal>
                <div class="tab-content" id="strategies-content" [class.active]="isTabActive('strategies')">
                    <app-strategy [currentProfileId]="currentProfileIdForModal"></app-strategy>
                </div>

                <div class="tab-content" id="notes-content" class="tab-content" [class.active]="isTabActive('notes')">
                    <app-notes [currentProfileId]="currentProfileIdForModal"></app-notes>
                </div>
            </div>
        </div>

    </main>
</div>