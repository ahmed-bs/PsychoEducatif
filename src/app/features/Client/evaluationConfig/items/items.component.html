<!-- src/app/items/items.component.html -->
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Sharp" rel="stylesheet">

<div class="back-button" (click)="goBack()">
  <span class="material-symbols-sharp">arrow_back</span>
</div>
<br><br>

<p-toast></p-toast>

<div class="card">
  <div class="add-item-section">
    <h2>Ajouter un nouvel item</h2>
    
    <div class="form-row">
      <div class="form-group">
        <label>Domaine</label>
        <p-dropdown [options]="domains" 
                   [(ngModel)]="selectedDomain" 
                   optionLabel="name" 
                   placeholder="Sélectionnez un domaine"
                   [style]="{'width':'100%'}">
        </p-dropdown>
      </div>
      
      <div class="form-group item-input">
        <label>Item</label>
        <input type="text" 
               pInputText 
               [(ngModel)]="newItem.name" 
               placeholder="Titre de l'item"
               [style]="{'width':'100%'}">
      </div>

      <div class="form-group item-input">
        <label>Description</label>
        <input type="text" 
               pInputText 
               [(ngModel)]="newItem.description" 
               placeholder="Description de l'item"
               [style]="{'width':'100%'}">
      </div>
      
      <button pButton 
              type="button" 
              label="Ajouter l'item" 
              icon="pi pi-plus" 
              class="add-item-btn"
              (click)="addItem()"
              [disabled]="!selectedDomain || !newItem.name">
      </button>
    </div>
  </div>
</div>

<div class="card">
  <h2>Items par domaine</h2>
  <button class="add-domain-btn" (click)="showAddDomainDialog()">
    <span class="pi pi-plus"></span> Ajouter un domaine
  </button>

  <div *ngFor="let domain of domains" class="domain-section">
    <div class="domain-header" (click)="toggleDomain(domain)">
      <span class="material-symbols-sharp">{{ domain.expanded ? 'expand_less' : 'expand_more' }}</span>
      <span class="domain-title">{{ domain.name }}</span>
      <span class="item-count">{{ itemsByDomain[domain.id]!.length || 0 }} items</span>
    <div class="domain-actions">
        <button pButton icon="pi pi-trash" class="p-button-text p-button-rounded p-button-danger" 
                (click)="deleteDomain(domain); $event.stopPropagation()"></button>
      </div>
    </div>

    <div class="item-list" *ngIf="domain.expanded">
      <div class="item-header">
        <div class="col-item">ITEM</div>
        <div class="col-etat">ÉTAT</div>
        <div class="col-description">DESCRIPTION</div>
        <div class="col-actions">ACTIONS</div>
      </div>

      <div class="item-row" *ngFor="let item of itemsByDomain[domain.id]">
        <div class="col-item">{{ item.name }}</div>
        <div class="col-etat">
          <span [class]="'status-badge status-' + item.etat.toLowerCase()">
            {{ item.etat === 'NON_COTE' ? 'Non coté' :
               item.etat === 'ACQUIS' ? 'Acquis' :
               item.etat === 'PARTIEL' ? 'Partiel' :
               item.etat === 'NON_ACQUIS' ? 'Non acquis' : item.etat }}
          </span>
        </div>
        <div class="col-description">{{ item.description || 'N/A' }}</div>
        <div class="col-actions">
          <button pButton icon="pi pi-pencil" class="p-button-text p-button-rounded p-button-info" (click)="showEditItemDialog(item, domain)"></button>
          <button pButton icon="pi pi-trash" class="p-button-text p-button-rounded p-button-danger" (click)="deleteItem(item, domain)"></button>
        </div>
      </div>

      <div *ngIf="!itemsByDomain[domain.id]?.length" class="no-items">
        Aucun item dans ce domaine
      </div>
    </div>
  </div>
</div>

<!-- Add Domain Dialog -->
<p-dialog [(visible)]="displayAddDomainDialog" [modal]="true" [style]="{ width: '40vw' }" [draggable]="false" [resizable]="false">
  <ng-template pTemplate="header">
    <div class="custom-dialog-header">
      <h2>{{ newDomain.id ? 'Modifier' : 'Ajouter' }} un domaine</h2>
    </div>
  </ng-template>
  <div class="dialog-content">
    <div class="field">
      <label for="domainName">Titre</label>
      <input pInputText id="domainName" [(ngModel)]="newDomain.name" placeholder="Titre" required />
    </div>
    <div class="field">
      <label for="domainDesc">Description</label>
      <input pInputText id="domainDesc" [(ngModel)]="newDomain.description" placeholder="Description" required />
    </div>
  </div>
  <ng-template pTemplate="footer">
    <p-button label="Annuler" styleClass="p-button-text" (click)="displayAddDomainDialog = false"></p-button>
    <p-button [label]="newDomain.id ? 'Modifier' : 'Ajouter'" styleClass="p-button-primary" (click)="newDomain.id ? updateDomain() : addDomain()" [style]="{ color: 'white' }"></p-button>
  </ng-template>
</p-dialog>

<!-- Edit Item Dialog -->
<p-dialog [(visible)]="displayAddItemDialog" [modal]="true" [style]="{ width: '40vw' }" [draggable]="false" [resizable]="false">
  <ng-template pTemplate="header">
    <div class="custom-dialog-header">
      <h2>{{ selectedItem ? 'Modifier' : 'Ajouter' }} un item</h2>
    </div>
  </ng-template>
  <div class="dialog-content">
    <div class="field">
      <label for="itemName">Titre</label>
      <input pInputText id="itemName" [(ngModel)]="newItem.name" placeholder="Titre" required />
    </div>
    <div class="field">
      <label for="itemDesc">Description</label>
      <input pInputText id="itemDesc" [(ngModel)]="newItem.description" placeholder="Description" />
    </div>
    <div class="field">
      <label for="itemEtat">État</label>
      <p-dropdown id="itemEtat" 
                 [options]="statusOptions"
                 [(ngModel)]="newItem.etat" 
                 placeholder="Sélectionner l'état">
      </p-dropdown>
    </div>
  </div>
  <ng-template pTemplate="footer">
    <p-button label="Annuler" styleClass="p-button-text" (click)="displayAddItemDialog = false"></p-button>
    <p-button [label]="selectedItem ? 'Modifier' : 'Ajouter'" styleClass="p-button-primary" (click)="selectedItem ? updateItem() : addItem()" [style]="{ color: 'white' }"></p-button>
  </ng-template>
</p-dialog>

