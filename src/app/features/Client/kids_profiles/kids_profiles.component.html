<div class="head-title">
    <div class="left">
      <h1>üôç‚Äç‚ôÄÔ∏èüôç‚Äç‚ôÇÔ∏è Profil</h1>
      <ul class="breadcrumb">
        <li><a href="#">Tableau de bord</a></li>
        <li><i class="bx bx-chevron-right"></i></li>
        <li><a class="active" href="#">üôç‚Äç‚ôÄÔ∏èüôç‚Äç‚ôÇÔ∏è Profil</a></li>
      </ul>
    </div>
    <div class="right">
      <p-button label="Ajouter un enfant" icon="pi pi-plus" styleClass="'displayDialog()"></p-button>
    </div>
  </div>
  <div class="container-custom">
    <div class="row">
      <div class="col-md-5">
        <div class="search-bar">
          <span class="p-input-icon-left">
            <i class="pi pi-search"></i>
            <input pInputText type="text" [(ngModel)]="searchTerm" placeholder="Rechercher un enfant par nom" (input)="filterChildren()" class="search-input" />
          </span>
        </div>
        <div class="cards-container">
          <div class="course-card" *ngFor="let child of filteredChildren" (click)="selectChild(child)">
            <div class="course-content">
              <svg class="circle-chart" viewBox="0 0 33.83 33.83" width="80" height="80">
                <defs>
                  <pattern id="img_{{child.id}}" patternUnits="userSpaceOnUse" height="80" width="80">
                    <image x="5" y="5" height="70%" width="70%" [attr.xlink:href]="child.image_url"></image>
                  </pattern>
                </defs>
                <circle class="circle-chart__background" cx="16.915" cy="16.915" r="15.915"></circle>
                <circle class="circle-chart__circle" [attr.stroke-dasharray]="child.evaluation_score" cx="16.915" cy="16.915" r="15.915"></circle>
              </svg>
              <div class="course-details">
                <a href="#" class="course-title">{{ child.first_name }} {{ child.last_name }}</a>
                <div class="course-info">
                  <p><i class="fas fa-check-circle"></i> {{ child.objectives?.length || 0 }} comp√©tences acquises</p>
                  <p><i class="fas fa-hourglass-half"></i> {{ child.objectives?.length || 0 }} en cours</p>
                  <p><i class="fas fa-times-circle"></i> {{ child.evaluation_score && child.evaluation_score < 50 ? 1 : 0 }} non acquises</p>
                  <p><i class="fas fa-bullseye"></i> {{ child.objectives?.length || 0 }} objectifs actifs</p>
                </div>
              </div>
            </div>
            <div class="course-footer">
              <h2 class="progress-percentage">{{ child.evaluation_score || 0 }}%</h2>
              <div class="btn-group">
                <button class="btn btn-skip" (click)="disableChild(child); $event.stopPropagation()">D√©sactiver</button>
                <button class="btn btn-continue" (click)="selectChild(child)">Voir le Profil</button>
              </div>
            </div>
          </div>
          <div class="no-children-message" *ngIf="filteredChildren.length === 0">
            <p>Vous n'avez pas d'enfant.</p>
          </div>
        </div>
      </div>
      <div class="col-md-7">
        <div class="row" *ngIf="selectedChild">
          <div class="col-md-6">
            <div class="card profile-card mb-3">
              <div class="profile-header" style="position: relative;">
                <a href="#" class="edit-icon" style="position: absolute; top: 10px; right: 10px;" (click)="showEditDialog()">
                  <i class="fa fa-pencil" aria-hidden="true" style="color: #4da5d8; font-size: 20px;"></i>
                </a>
                <a class="share-icon" style="position: absolute; top: 10px; right: 50px;" (click)="showShareDialog()">
                  <i class="pi pi-share-alt" style="color: #a01717; font-size: 20px;"></i>
                </a>
              </div>
              <div class="profile-avatar">
                <img [src]="selectedChild.image_url" [alt]="'Avatar de ' + selectedChild.first_name + ' ' + selectedChild.last_name">
              </div>
              <div class="profile-info">
                <h3><a href="#" class="text-dark">{{ selectedChild.first_name }} {{ selectedChild.last_name }}</a></h3>
                <p><i class="fa fa-map-marker" aria-hidden="true"></i> {{ selectedChild.notes || 'Non sp√©cifi√©' }}</p>
                <div class="profile-stats">
                  <div class="stat-card">
                    <i class="fa fa-check-circle"></i>
                    <h4>{{ selectedChild.objectives?.length || 0 }}</h4>
                    <p>Comp√©tences acquises</p>
                  </div>
                  <div class="stat-card">
                    <i class="fa fa-bullseye"></i>
                    <h4>{{ selectedChild.evaluation_score || 0 }}%</h4>
                    <p>√âvaluation</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="card points-card mb-3">
              <div class="points-info">
                <h2>{{ selectedChild.evaluation_score || 0 }}%</h2>
                <h5>Progr√®s global</h5>
                <div class="btn-group">
                  <button class="btn btn-skip">Exporter</button>
                  <button class="btn btn-continue" (click)="showEditDialog()">Mettre √† jour</button>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-md-6">
                <div class="card action-card consultation-card mb-3">
                  <div class="action-header">
                    <i class="fas fa-clipboard-check"></i>
                    <i class="mdi mdi-arrow-top-right action-icon"></i>
                  </div>
                  <div style="margin-top: 40px;">
                    <h4>√âvaluation</h4>
                    <p>√âvaluer les comp√©tences</p>
                  </div>
                </div>
              </div>
              <div class="col-md-6">
                <div class="card action-card set-target-card mb-3">
                  <div class="action-header">
                    <i class="fas fa-bullseye"></i>
                    <i class="mdi mdi-arrow-top-right action-icon"></i>
                  </div>
                  <div style="margin-top: 40px;">
                    <h4>Objectifs</h4>
                    <p>D√©finir ou ajuster les objectifs</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- Chart and Skills sections remain unchanged -->
      </div>
    </div>
  </div>
  
  <p-dialog header="Ajouter un enfant" [(visible)]="displayDialog" [modal]="true" [style]="{ width: '40vw' }">
    <div class="dialog-content">
      <div class="field">
        <label for="firstName">Pr√©nom</label>
        <input pInputText id="firstName" [(ngModel)]="newChild.first_name" placeholder="Pr√©nom" required />
      </div>
      <div class="field">
        <label for="lastName">Nom</label>
        <input pInputText id="lastName" [(ngModel)]="newChild.last_name" placeholder="Nom" required />
      </div>
      <div class="field">
        <label for="birthDate">Date de naissance</label>
        <input pInputText id="birthDate" type="date" [(ngModel)]="newChild.birth_date" required />
      </div>
      <div class="field">
        <label for="diagnosis">Diagnostic</label>
        <input pInputText id="diagnosis" [(ngModel)]="newChild.diagnosis" placeholder="Diagnostic" />
      </div>
      <div class="field">
        <label for="notes">Notes</label>
        <input pInputText id="notes" [(ngModel)]="newChild.notes" placeholder="Notes" />
      </div>
      <div class="field">
        <label for="evaluationScore">Score d'√©valuation</label>
        <input pInputText id="evaluationScore" type="number" [(ngModel)]="newChild.evaluation_score" placeholder="Score (0-100)" />
      </div>
      <div class="field">
        <label for="objectives">Objectifs (s√©par√©s par des virgules)</label>
        <input pInputText id="objectives" [(ngModel)]="newChild.objectives" (ngModelChange)="newChild.objectives = $event ? $event.split(',') : []" placeholder="Ex: Communication, Autonomie" />
      </div>
      <div class="field">
        <label for="progress">Progr√®s</label>
        <input pInputText id="progress" [(ngModel)]="newChild.progress" placeholder="Ex: En progr√®s" />
      </div>
      <div class="field">
        <label for="strategies">Strat√©gies (s√©par√©es par des virgules)</label>
        <input pInputText id="strategies" [(ngModel)]="newChild.recommended_strategies" (ngModelChange)="newChild.recommended_strategies = $event ? $event.split(',') : []" placeholder="Ex: Renforcement positif" />
      </div>
      <div class="field">
        <label for="imageUrl">URL de l'image</label>
        <input pInputText id="imageUrl" [(ngModel)]="newChild.image_url" placeholder="URL de l'image (optionnel)" />
      </div>
    </div>
    <ng-template pTemplate="footer">
      <p-button label="Annuler" styleClass="p-button-text" (click)="cancel()"></p-button>
      <p-button label="Ajouter" styleClass="p-button-primary" (click)="addChild()"></p-button>
    </ng-template>
  </p-dialog>
  
  <p-dialog header="Modifier le profil" [(visible)]="displayEditDialog" [modal]="true" [style]="{width: '50vw'}" [draggable]="false" [resizable]="false">
    <div class="p-fluid">
      <div class="p-field">
        <label for="firstName">Pr√©nom</label>
        <input pInputText id="firstName" [(ngModel)]="selectedChild!.first_name!" type="text" required />
      </div>
      <div class="p-field">
        <label for="lastName">Nom</label>
        <input pInputText id="lastName" [(ngModel)]="selectedChild!.last_name!" type="text" required />
      </div>
      <div class="p-field">
        <label for="birthDate">Date de naissance</label>
        <input pInputText id="birthDate" [(ngModel)]="selectedChild!.birth_date" type="date" required />
      </div>
      <div class="p-field">
        <label for="diagnosis">Diagnostic</label>
        <input pInputText id="diagnosis" [(ngModel)]="selectedChild!.diagnosis" type="text" />
      </div>
      <div class="p-field">
        <label for="notes">Notes</label>
        <input pInputText id="notes" [(ngModel)]="selectedChild!.notes" type="text" />
      </div>
      <div class="p-field">
        <label for="evaluationScore">Score d'√©valuation</label>
        <input pInputText id="evaluationScore" [(ngModel)]="selectedChild!.evaluation_score" type="number" />
      </div>
      <div class="p-field">
        <label for="objectives">Objectifs (s√©par√©s par des virgules)</label>
        <input pInputText id="objectives" [(ngModel)]="selectedChild!.objectives" (ngModelChange)="selectedChild!.objectives = $event ? $event.split(',') : []" type="text" />
      </div>
      <div class="p-field">
        <label for="progress">Progr√®s</label>
        <input pInputText id="progress" [(ngModel)]="selectedChild!.progress" type="text" />
      </div>
      <div class="p-field">
        <label for="recommendedStrategies">Strat√©gies recommand√©es (s√©par√©es par des virgules)</label>
        <input pInputText id="recommendedStrategies" [(ngModel)]="selectedChild!.recommended_strategies" (ngModelChange)="selectedChild!.recommended_strategies = $event ? $event.split(',') : []" type="text" />
      </div>
      <div class="p-field">
        <label for="imageUrl">URL de l'image</label>
        <input pInputText id="imageUrl" [(ngModel)]="selectedChild!.image_url" type="text" />
      </div>
    </div>
    <p-footer>
      <button pButton type="button" label="Annuler" class="p-button-secondary" (click)="cancelEdit()"></button>
      <button pButton type="button" label="Enregistrer" class="p-button-primary" (click)="saveChild()"></button>
    </p-footer>
  </p-dialog>
  
  <p-dialog header="Partager le profil" [(visible)]="afficherBoiteDialoguePartage" [modal]="true" [style]="{width: '500px'}">
    <div class="p-fluid">
      <div class="p-field">
        <label for="email">Email du parent</label>
        <input pInputText id="email" [(ngModel)]="saisieEmail" placeholder="Entrez l'email du parent" />
      </div>
      <div class="p-field">
        <label for="access">Niveau d'acc√®s</label>
        <p-dropdown id="access" [options]="optionsAcces" [(ngModel)]="accesSelectionne" optionLabel="libelle" placeholder="S√©lectionner un acc√®s"></p-dropdown>
      </div>
    </div>
    <p-footer>
      <button pButton type="button" label="Annuler" class="p-button-secondary" (click)="afficherBoiteDialoguePartage = false"></button>
      <button pButton type="button" label="Partager" class="p-button-primary" (click)="shareProfile()"></button>
    </p-footer>
  </p-dialog>